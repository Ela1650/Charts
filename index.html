<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <link rel="stylesheet" href="src/style.css">
  <script src=" https://cdn.jsdelivr.net/npm/echarts@5.6.0/dist/echarts.min.js "></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vite App</title>
  <style>
    h1 {
      color: #fff;
      margin: 40px auto;
      font-size: 50px;
      text-align: center;
    }
  </style>
</head>

<body>
  <h1>Post Profile Chart</h1>
  <div id="post-charts">
    <div class="engagement-summary">
      <div id="post-engagement-summary" class="post-engagement-summary" ></div>
    </div>
    <div class="total-read-time">
      <div class="total-readed-time chart">
        <div id="readed-time-chart" class="total-readed-time-chart" style="width: 700px; height: 500px"></div>
      </div>
      <div class="article-total-read-time-completion-rate chart">
        <div id="article-read-time-chart" class="article-total-read-time" style="width: 700px; height: 500px"></div>
      </div>
    </div>
    <div class="completion-rate-audience-breakdown-for-article">
      <div id="completion-rate-for-article-chart" class="completion-rate-audience-breakdown-for-article-chart"
        style="width: 700px; height: 500px"></div>
    </div>
    <div class="interaction-graphs">
      <div class="interaction-type-count-with-interaction-name-for-article">
        <div id="interaction-type-count-with-name"
          class="interaction-type-count-with-interaction-name-for-article-chart" style="width: 700px; height: 500px">
        </div>
      </div>
      <div class="interaction-score-by-audience-type-article">
        <div id="article-interaction-score-by-audience-type" class="interaction-score-by-audience-type-article-chart"
          style="width: 700px; height: 500px">
        </div>
      </div>
    </div>

    <div class="audience-level-peoples-choice-percentages-for-article">
      <div id="audience-level-peoples-choice-percentages"
        class="audience-level-peoples-choice-percentages-for-article-chart" style="width: 900px; height: 500px"></div>
    </div>
    <div class="article-engagement-popularity-sentiment">
      <div id="article-engagement-popularity" class="article-engagement-popularity-sentiment-chart"
        style="width: 900px; height: 500px"></div>
    </div>
    <div class="sentiment-breakdown-by-Audience-type">
      <div id="article-sentiment-breakdown-by-Audience-type" class="article-sentiment-breakdown-by-Audience-type"
        style="width: 700px; height: 500px">
      </div>
    </div>

    <div class="engagement-popularity">
      <div id="article-engagement-popularity" class="article-engagement-popularity" style="width: 700px; height: 500px">
      </div>
    </div>
  </div>

  <h1>User Profile Chart</h1>
  <div id="user-charts">
    <div class="user-catergorical-reputation-data-chart chart">
      <div id="user-catergorical-reputation-data" style="width: 700px; height: 500px"></div>
    </div>
    <div class="network-analysis-reputation-score-percentage-for-user chart">
      <div id="network-analysis-reputation-score-percentage" style="width: 700px; height: 750px;"></div>
    </div>
    <div class="user-expertise-level-and-user-nature-for-user-chart chart">
      <div id="user-expertise-level-and-user-nature-for-user" style="width: 900px; height: 500px"></div>
    </div><br><br>
    <div class="interaction-breakdown-in-numbers-users-favorite-chart chart">
      <div id="interaction-breakdown-in-numbers-users-favorite" style="width: 1000px; height: 500px;"></div>
    </div><br>
    <div class="number-Of-MPXR-from-publication-for-user-chart chart">
      <div id="number-of-MPXR-from-publication-for-user" style="width: 700px; height: 500px"></div>
    </div>
    <div class="MPXR-from-interaction-percentage-user-chart chart">
      <div id="MPXR-from-interaction-percentage-user" style="width: 700px; height: 500px"></div>
    </div>
  </div>


  <script type="text/javascript">
    const options = {
      articleReadTimeChartOptions: {
        tooltip: {
          formatter: "{a} <br/>{b} : {c} mins",
        },
        title: {
          text: "Total articles read time by audience ",
          textStyle: {
            color: "#ffffff",

          },
        },
        series: [
          {
            name: "",
            type: "gauge",
            color: ['#ffffff'],
            splitLine: {
                        show: false
                    },
                    axisTick: {
                        show: false
                    },
                    axisLabel: {
                        show: false
                    },

            detail: {
              formatter: "{value} read time",
              color: '#ffffff',
            },
            data: [
              {
                value: 50,

                name: "total read time",
              },
            ],
          },
        ],
      },
      ArticleTotalReadTimeChartOption: {
        title: {
          text: 'Total article read time Completion Rate',
          textStyle: {
            color: "#ffffff",

          },
        },
        series: [
       
          {

            type: "gauge",
            startAngle: 90,
            endAngle: -270,
            pointer: {
              show: false,
            },
            progress: {
              show: true,
              overlap: false,
              roundCap: true,

              clip: false,
              itemStyle: {
                borderWidth: 1,
                borderColor: "#464646",
              },
            },
            axisLine: {
              lineStyle: {
                width: 40,
                color: '#032c43'
              },

              roundCap: true
            },
            splitLine: {
              show: false,
              distance: 0,
              length: 10,
            },
            axisTick: {
              show: false,
            },
            axisLabel: {
              show: false,
              distance: 50,
            },
            title: {
              fontSize: 14,
              color: '#fff'
            },
            detail: {
              width: 50,
              height: 14,
              fontSize: 14,
              color: "inherit",
              borderColor: "inherit",
              borderRadius: 20,
              borderWidth: 1,
              formatter: "{value}%",
            },
          },
        ],
      },
      totalReadedTimeChartOption: {
        tooltip: {
          formatter: "{a} <br/>{b} : {c}%",
        },
        series: [
          {
            name: "Pressure",
            type: "gauge",
            progress: {
              show: true,
            },
            detail: {
              valueAnimation: true,
              formatter: "{value}",
            },
            data: [
              {
                value: 10,
                name: "SCORE",
              },
            ],
          },
        ],
      },
      completionRateForArticleOption: {
        legend: {},
        tooltip: {},
        dataset: {},
        series: [],
      },
      interactionTypeCountWithNameOption: {
        title: {
          text: 'Interaction type count with interaction name',
          textStyle: {
            color: '#ffffff'
          }
        },
        tooltip: {
          trigger: "axis",
          axisPointer: {
            type: "shadow",
          },
        },
        grid: {
          left: "3%",
          right: "4%",
          bottom: "3%",
          containLabel: true,
        },
        xAxis: [],
        yAxis: [
          {
            type: "value",
          },
        ],
        series: [],
      },
      articleInteractionScoreByAudienceTypeOption: {
        // backgroundColor: {
        //   image: [],
        //   repeat: "repeat",
        // },
        title: {
          text: "Interaction Score By Audience Type",
          textStyle: {
            color: "#ffffff",
          },
        },
        tooltip: {},
        // xAxis: {
        //   type: 'category',
        //   data: ["Average Audience", "Intermediate Audience", "Advanced Audience", "Expert Audience"],
        //   axisTick: {
        //     alignWithLabel: true,
        //   },
        //   axisLabel: {
        //     interval: 0,

        //     textStyle: {
        //       color: "#ffffff",
        //     },
        //   },
        // },
        // yAxis: {
        //   type: 'value',
        //   axisLabel: {
        //     interval: 0,

        //     textStyle: {
        //       color: "#ffffff",
        //     },
        //   },
        // },
        series: [
          {
            name: "pie",
            type: "pie",
            radius: ['40%', '70%'],
            selectedMode: "single",
            selectedOffset: 30,
            clockwise: true,
            center: "50%",
            color:[
              '#8979FF',
              '#57C2CE',
              '#79FF8D',
              '#FF9B5C',
            ],
            label: {
              fontSize: 14,
              color: "#fff",
            },
            labelLine: {
              lineStyle: {
                color: "#fff",
              },
            },
            data: [],

          },
        ],
      },
    }
    let selectors = {
      articleTotalReadTimeChart: document.getElementById("readed-time-chart"),
      articleReadTimeChart: document.getElementById("article-read-time-chart"),
      readTimeChart: document.getElementById("article-engagement-popularity"),
      sentimentByAudienceType: document.getElementById("article-sentiment-breakdown-by-Audience-type"),
      completionRateForArticleChart: document.getElementById(
        "completion-rate-for-article-chart"
      ),
      articleEngagement: document.getElementById(
        "article-engagement-popularity"
      ),
      engagementSummary: document.getElementById(
        "post-engagement-summary"
      ),
      interactionTypeCountWithName: document.getElementById(
        "interaction-type-count-with-name"
      ),
      articleInteractionScoreByAudienceType: document.getElementById(
        "article-interaction-score-by-audience-type"
      ),
      audienceLevelPeoplesChoicePercentages: document.getElementById(
        "audience-level-peoples-choice-percentages"
      ),
    };

    let posts = [
      {
        post_id: 1,
        community: "test",
        content_type: "post",
        author: 1,
        editors: [],
        peoples_choice: 0,
        post_source: "",
        read_time: 5.6,
        categories: [],
        tags: [],
        post_rep: 0.0,
        deleted_post: false,
        feed_status: false,
        read_count: 7,
        post_slug: "test",
        percentages: {
          "Total Interaction Counts": {
            total_interaction: 7,
            total_positive_interaction: 5,
            total_positive_interaction_breakdown: {
              "Average Audience": 40.0,
              "Intermediate Audience": 40.0,
              "Advanced Audience": 0.0,
              "Expert Audience": 20.0,
            },
            total_negative_interaction: 2,
            total_negative_interaction_breakdown: {
              "Average Audience": 50.0,
              "Intermediate Audience": 0.0,
              "Advanced Audience": 0.0,
              "Expert Audience": 50.0,
            },
            emoji: {
              count: 21,
            },
            react: {
              count: 12,
            },
            time_spent: {
              count: 4,
            },
            comment: {
              count: 5,
            },
          },
          "Total interaction in Percentages": {
            emoji: 14.285714285714285,
            react: 14.285714285714285,
            time_spent: 57.14285714285714,
            comment: 14.285714285714285,
          },
          "Total Read Completion Rate": {
            "Total completion_rate": 88.75,
            "Total Completion rate breakdown": {
              Average: 0.0,
              Good: 25.0,
              Best: 75.0,
            },
            "Total Audience Completion rate Breakdown": {
              "Average Audience": {
                Average: 0.0,
                Good: 50.0,
                Best: 50.0,
              },
              "Intermediate Audience": {
                Average: 0.0,
                Good: 0.0,
                Best: 100.0,
              },
              "Advanced Audience": {
                Average: 0,
                Good: 0,
                Best: 0,
              },
              "Expert Audience": {
                Average: 0.0,
                Good: 0.0,
                Best: 100.0,
              },
            },
          },
          "Audience Level interaction percentages": {
            "Average Audience": 42.857142857142854,
            "Intermediate Audience": 28.57142857142857,
            "Advanced Audience": 0.0,
            "Expert Audience": 28.57142857142857,
          },
          "Article Sentiment Popularity Breakdown": {
            Popularity: "Not Popular",
          },
          "Article Sentiment Likability Breakdown": {
            likability: "Unlikable",
          },
          "Article Sentiment Engagement Breakdown": {
            engagement: "Less Engaging",
            engagement_percentage: 42.857142857142854,
          },
          "Audience Level Peoples Choice Percentages": {
            "Average Audience": 0,
            "Intermediate Audience": 0,
            "Advanced Audience": 0,
            "Expert Audience": 0,
          },
        },
      },
      {
        post_id: 2,
        community: "test",
        content_type: "post",
        author: 1,
        editors: [],
        peoples_choice: 0,
        post_source: "",
        read_time: 5.6,
        categories: [],
        tags: [],
        post_rep: 0.0,
        deleted_post: false,
        feed_status: false,
        read_count: 7,
        post_slug: "test",
        percentages: {
          "Total Interaction Counts": {
            total_interaction: 7,
            total_positive_interaction: 5,
            total_positive_interaction_breakdown: {
              "Average Audience": 40.0,
              "Intermediate Audience": 40.0,
              "Advanced Audience": 0.0,
              "Expert Audience": 20.0,
            },
            total_negative_interaction: 2,
            total_negative_interaction_breakdown: {
              "Average Audience": 50.0,
              "Intermediate Audience": 0.0,
              "Advanced Audience": 0.0,
              "Expert Audience": 50.0,
            },
            emoji: {
              count: 21,
            },
            react: {
              count: 12,
            },
            time_spent: {
              count: 4,
            },
            comment: {
              count: 5,
            },
          },
          "Total interaction in Percentages": {
            emoji: 14.285714285714285,
            react: 14.285714285714285,
            time_spent: 57.14285714285714,
            comment: 14.285714285714285,
          },
          "Total Read Completion Rate": {
            "Total completion_rate": 88.75,
            "Total Completion rate breakdown": {
              Average: 0.0,
              Good: 25.0,
              Best: 75.0,
            },
            "Total Audience Completion rate Breakdown": {
              "Average Audience": {
                Average: 0.0,
                Good: 50.0,
                Best: 50.0,
              },
              "Intermediate Audience": {
                Average: 0.0,
                Good: 0.0,
                Best: 100.0,
              },
              "Advanced Audience": {
                Average: 0,
                Good: 0,
                Best: 0,
              },
              "Expert Audience": {
                Average: 0.0,
                Good: 0.0,
                Best: 100.0,
              },
            },
          },
          "Audience Level interaction percentages": {
            "Average Audience": 42.857142857142854,
            "Intermediate Audience": 28.57142857142857,
            "Advanced Audience": 10.058421684555,
            "Expert Audience": 28.57142857142857,
          },
          "Article Sentiment Popularity Breakdown": {
            Popularity: "Not Popular",
          },
          "Article Sentiment Likability Breakdown": {
            likability: "Unlikable",
          },
          "Article Sentiment Engagement Breakdown": {
            engagement: "Less Engaging",
            engagement_percentage: 42.857142857142854,
          },
          "Audience Level Peoples Choice Percentages": {
            "Average Audience": 15,
            "Intermediate Audience": 40,
            "Advanced Audience": 25,
            "Expert Audience": 20,
          },
        },
      },
    ];


    //functions
    const initArticleReadTimeChart = (readTime) => {
      let chart = echarts.init(selectors.articleTotalReadTimeChart);
      let series = {
        name: "Total read time",
        type: 'gauge',
                    startAngle: -1,
                    endAngle: 10,
                    radius: '70%',
                    progress: {
                        show: true,
                        overlap: false,
                        roundCap: true,
                        clip: false,
                        itemStyle: {
                            color: '#00FF99'
                        }
                    },
                    pointer: {
                        show: false
                    },
                    axisLine: {
                        lineStyle: {
                            width: 30,
                            color: [[1, '#303A52']]
                        }
                    },
                    splitLine: {
                        show: false
                    },
                    axisTick: {
                        show: false
                    },
                    axisLabel: {
                        show: false
                    },
                    detail: {
                      valueAnimation: true,
                        formatter: function (value) {
                            return `{value|${value}}\n{unit|mins read}`;
                        },
                        rich: {
                            value: {
                                fontSize: 40, 
                                fontWeight: 'bold',
                                color: '#fff'
                            },
                            unit: {
                                fontSize: 16,
                                fontWeight: 'bold',
                                color: '#fff'
                            }
                        },
                        offsetCenter: [0, 0] 
                    },
        data: [
          {
            value: readTime,
            name: "",

          },
        ],
      };

      chart.setOption({ ...options.articleReadTimeChartOptions, series });
    };
    const initArticleTotalReadTimeChart = (data) => {
      let chart = echarts.init(selectors.articleReadTimeChart);

      function structureData(data) {
        data = Object.entries(data);
        let tempValue = [];
        data.forEach((element, index) => {
          tempValue.push({
            value: element[1],
            name: element[0],
            title: {
              offsetCenter: ["-20%", `-${index * 15}%`],
            },
            detail: {
              valueAnimation: true,
              offsetCenter: ["15%", `-${index * 15} % `],
            },
          });
        });

        return tempValue;
      }

      let structuredData = structureData(
        data.percentages["Total Read Completion Rate"][
        "Total Completion rate breakdown"
        ]
      );

      const series = options.ArticleTotalReadTimeChartOption.series[0];
      chart.setOption({
        ...options.ArticleTotalReadTimeChartOption,
        series: { ...series, data: structuredData },
      });
    };

    const initReadTimeChart = (data) => {
      const chart = echarts.init(selectors.readTimeChart);
      let dataa = [
        {
          value: 100,
          name: "SCORE",
        },
      ];
      const series = options.totalReadedTimeChartOption.series[0];
      chart.setOption({
        ...options.totalReadedTimeChartOption,
        series: { ...series, data: dataa },
      });
    };
    const initEngagementSummary = (data) => {
      const chart = echarts.init(selectors.engagementSummary, null, {
        height: 150
      });
      const datas = data.percentages
      const categories = Object.keys(datas["Total interaction in Percentages"]);
      const values = Object.values(datas["Total interaction in Percentages"]);

      const colors = ['#FFC107', '#4CAF50', '#2196F3', '#F44336']; // Yellow, Green, Blue, Red

      option = {
        title: {
          text: 'Engagement Summary',
          textStyle: {
            color: '#ffffff'
          }
        },
        
        grid: {
          top: '5%',
          left: '3%',
          right: '3%',
          bottom: '20%',
          containLabel: true
        },
        legend: {
          orient: 'horizontal',
          bottom: 0,
          left: 'center',
          itemGap: 25,
          icon: 'circle',
          textStyle: {
            color: '#ffffff',
            fontSize: 14
          },
          formatter: function (name) {
            const index = categories.findIndex(cat => cat.charAt(0).toUpperCase() + cat.slice(1) === name);

            const roundedValue = Math.round(values[index]);
            return `${name}: ${roundedValue}%`;
          }
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: { type: 'shadow' }
        },


        xAxis: {
          type: 'value',
          splitLine: { show: false },
          axisLine: { show: false },
          axisTick: { show: false },
          axisLabel: { show: false }
        },
        yAxis: {
          type: 'category',
          data: ['Total Interaction'],
          splitLine: { show: false },
          axisLine: { show: false },
          axisTick: { show: false },
          axisLabel: { show: false }
        },
        series: categories.map((category, index) => ({
          name: category.charAt(0).toUpperCase() + category.slice(1),
          type: 'bar',
          stack: 'total',
          itemStyle: { color: colors[index] },
          data: [values[index]],
          barWidth: '60px',
          emphasis: {
            focus: 'series'
          },
        }))

      };
      chart.setOption(option)
    }
    const initArticleEngagement = (data) => {
      const chart = echarts.init(selectors.articleEngagement);

    }
    const initCompletionRateForArticleChart = (data) => {
      const chart = echarts.init(selectors.completionRateForArticleChart);
      const breakdown =
        data.percentages["Total Read Completion Rate"][
        "Total Audience Completion rate Breakdown"
        ];
      let title = [];
      let series = [];
      const audienceTypes = Object.keys(breakdown);

      const source = [["Audience Type", "Average", "Good", "Best"]];
      audienceTypes.forEach((audienceType, index) => {
        const audienceData = breakdown[audienceType];
        const pieData = [
          { value: audienceData.Average, name: "Average" },
          { value: audienceData.Good, name: "Good" },
          { value: audienceData.Best, name: "Best" },
        ];

        title.push({
          text: "",
        });

        series.push({
          type: "pie",

          radius: "40%",
          center: [index % 2 === 0 ? "30%" : "85%", index < 2 ? "22%" : "77%"],
          top: 60,
          data: pieData,
          label: {
            show: false,
            color: "#ffffff",
            borderWidth: 0,
            borderColor: "transparent",
          },
          color:[
              '#8979FF',
              
              '#79FF8D',
              '#FF9B5C',
            ],
          emphasis: {
            itemStyle: {
              shadowBlur: 10,
              shadowOffsetX: 0,
              shadowColor: "rgba(0, 0, 0, 0.5)",
            },
          },
        });

        // Add the audience type data to the source
        source.push([
          audienceType,
          audienceData.Average,
          audienceData.Good,
          audienceData.Best,
        ]);
      });
      const chartTitle = audienceTypes.map((audienceType, index) => {
        return {
          text: `Completion By ${audienceType}`,
          left: index % 2 === 0 ? "25%" : "75%",
          top: index < 2 ? "5%" : "53%", // Adjust top position as per your layout
          textAlign: "center",

          textStyle: {
            fontSize: 14,
            fontWeight: "bold",
            color: "#ffffff", // Customize the color as needed
          },
        };
      });

      // Set the updated options for the chart with the dynamically created series and source
      chart.setOption({
        ...options.completionRateForArticleOption,
        title: chartTitle,
        dataset: {
          source: source,

        },
        series: series,
        legend: {
          textStyle: {
            color: "#ffffff",
          },

        },
      });
    };
    const initInteractionTypeCountWithName = (data) => {
      const chart = echarts.init(selectors.interactionTypeCountWithName);
      const interactionData = data.percentages["Total Interaction Counts"];
      const includedKeys = ["emoji", "react", "time_spent", "comment"];
      const categories = [];
      const seriesData = [];

      for (const key of includedKeys) {
        if (interactionData[key]) {
          categories.push(key);
          seriesData.push(interactionData[key].count);
        }
      }

      let xAxis = [
        {
          type: "category",
          data: categories,
          axisTick: {
            alignWithLabel: true,
          },
        },
      ];

      let series = [
        {
          name: "Count",
          type: "bar",
          barWidth: "60%",
          data: seriesData,
        },
      ];

      chart.setOption({
        ...options.interactionTypeCountWithNameOption,
        xAxis: xAxis,
        series: series,
      });
    };
    const initSentimentByAudienceType = (data) => {
      const chart = echarts.init(selectors.sentimentByAudienceType);

      const datas = data.percentages

      var xAxisData = Object.keys(datas["Total Interaction Counts"].total_positive_interaction_breakdown);
      var positiveData = Object.values(datas["Total Interaction Counts"].total_positive_interaction_breakdown);
      var negativeData = Object.values(datas["Total Interaction Counts"].total_negative_interaction_breakdown);

      var series = [
        {
          name: 'Positive Interactions',
          type: 'bar',
          stack: 'interactions',
          data: positiveData.map((value) => ({
            value,
            itemStyle: {
              borderRadius: [0, 0, 0, 0] // Rounded corners for positive bars
            }
          })),
          itemStyle: {
            color: '#8979FF' 
          }
        },
        {
          name: 'Negative Interactions',
          type: 'bar',
          stack: 'interactions',
          data: negativeData.map((value) => ({
            value: value, 
            itemStyle: {
              borderRadius: [10, 0, 0, 0] // Rounded corners for negative bars
            }
          })),
          itemStyle: {
            color: '#FF9B5C' 
          }
        }
      ];

      var option = {
        title: {
          text: 'Sentiment Breakdown by Audience type(positive and negative)',
          left: 'center',
          textStyle: {
            color: '#ffffff'
          }
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: {
            type: 'shadow'
          },
          formatter: function (params) {
            let content = params[0].axisValue + '<br/>';
            params.forEach(param => {
              content += `${param.seriesName}: ${Math.abs(param.value)}%<br/>`;
            });
            return content;
          }
        },
        legend: {
          data: ['Positive Interactions', 'Negative Interactions'],
          bottom: 10,
          textStyle: {
            color: '#fff'
          }
        },
        xAxis: {
          type: 'category',
          data: xAxisData
        },
        yAxis: {
          type: 'value',
          axisLabel: {
            formatter: '{value}%'
          },
          axisLabel: {
            interval: 0,

            textStyle: {
              color: "#ffffff",
            },
          },
        },
        series: series
      };

      chart.setOption(option);

    }
    //trouble with the images
    // const initArticleInteractionScoreByAudienceType = (data) => {

    //   const chart = echarts.init(selectors.articleInteractionScoreByAudienceType);
    //   const interactionData =
    //     data.percentages["Audience Level interaction percentages"];
    //   console.log(interactionData, 'here');
    //   const audienceLevels = Object.keys(interactionData);
    //   const seriesData = audienceLevels.map((audience) => ({
    //     value: interactionData[audience],
    //     name: audience,
    //   }));
    //   console.log(seriesData);
    //   const series = options.articleInteractionScoreByAudienceTypeOption.series[0];

    //   chart.setOption({
    //     ...options.articleInteractionScoreByAudienceTypeOption,
    //     /*backgroundColor: { ...backgroundColor, image: bgPatternSrc },*/
    //     series: {
    //       ...series,
    //       data: seriesData,
    //       /*itemStyle: { ...itemStyle, color: { ...color, image: piePatternSrc } },*/
    //     },
    //   });
    // };
    const initAudienceLevelPeoplesChoicePercentages = (data) => {
      const chart = echarts.init(selectors.articleInteractionScoreByAudienceType);
    };
    const initArticleInteractionScoreByAudienceType = (data) => {

      const chart = echarts.init(selectors.articleInteractionScoreByAudienceType);
      const interactionData =
        data.percentages["Audience Level interaction percentages"];
      console.log(interactionData);
      const audienceLevels = Object.keys(interactionData);
      const seriesData = audienceLevels.map((audience) => ({
        value: interactionData[audience],
        name: audience,
      }));
      console.log(seriesData);
      const series = options.articleInteractionScoreByAudienceTypeOption.series[0];

      chart.setOption({
        ...options.articleInteractionScoreByAudienceTypeOption,
        /*backgroundColor: { ...backgroundColor, image: bgPatternSrc },*/
        series: {
          ...series,
          data: seriesData,
          /*itemStyle: { ...itemStyle, color: { ...color, image: piePatternSrc } },*/
        },

      });
    };
    async function fetchedPostById(postId) {
      // const url = `http://localhost:3000/post/${postId}`; // Construct the URL using the postId
      // console.log(`Fetching post with post_id: ${postId}`);

      try {
        // const response = await fetch(url);

        // if (!response.ok) {
        //   throw new Error(`HTTP error! Status: ${response.status}`);
        // }
        let data
        if (postId != undefined) {
          const post = posts.find((u) => u.post_id == parseInt(postId));

          if (!post) {
            console.log("post not found");
          } else {
            data = post;

          }
        } else {
          console.log("id is undefined");
        }

        if (data) {
          console.log(`Fetched read_time: ${data.read_time}`);
          console.log(data);
          initArticleReadTimeChart(data.read_time);
          initArticleTotalReadTimeChart(data);
          // initReadTimeChart(data);
          initCompletionRateForArticleChart(data);
          initInteractionTypeCountWithName(data);
          initArticleInteractionScoreByAudienceType(data);
          initSentimentByAudienceType(data);
          initArticleEngagement(data);
          initEngagementSummary(data);
          // Update the charts with the fetched data
          // updateReadedChart(data.read_time);
          // updateArticleChartData(data); // Call without postId
          // updateCompletionRateForArticleChartData(data);
          // updateInteractionChart(data);
          // updateArticleInteractionScoreChart(data);
          // updateAudienceLevelPeoplesChoicePercentagesChart(data);
          //updateArticleEngagementPopularityChart(data);
        } else {
          console.log("Fetched data is not valid or 'read_time' is not defined.");
        }
      } catch (error) {
        console.error("Error when fetching the data:", error);
      }
    }

    fetchedPostById(2)
      .then((data) => {
        if (data) {
          console.log("Fetched data:", data);
        } else {
          console.log("No data fetched due to error.");
        }
      })
      .catch((error) => {
        console.error("Error:", error);
      });


      // User profile charts
    const userSelectors = {
    userCategoricalReputationChart: document.getElementById('user-catergorical-reputation-data'),
    networkAnalysisReputationChart: document.getElementById('network-analysis-reputation-score-percentage'),
    userExpertiseLevelChart: document.getElementById('user-expertise-level-and-user-nature-for-user'),
    interactionBreakdownChart: document.getElementById('interaction-breakdown-in-numbers-users-favorite'),
    mpxrFromPublicationChart: document.getElementById('number-of-MPXR-from-publication-for-user'),
    mpxrFromInteractionChart: document.getElementById('MPXR-from-interaction-percentage-user'),
    };

    const userProfileData = [
    {
    "user": 2,
    "mpxr": 3.50056,
    "vote_rep_availabe": 3.50055665,
    "public_address": null,
    "shared_rep": 0.0,
    "categories": [
        {
            "category": "3D Printing",
            "rep": 0.8333333333333333
        },
        {
            "category": "Aged Care",
            "rep": 0.8333333333333333
        },
        {
            "category": "AI",
            "rep": 0.83333333
        }
    ],
    "user_read_time": 12.0,
    "read_count": 3,
    "User Nature": {
        "user nature": "Audience user",
        "number of published articles": 0
    },
    "Total User Interaction Breakdown": {
        "Total User Number of Interactions": {
            "Total Interaction": 7,
            "Total Positive Interactions": 5,
            "Total Negative Interactions": 2,
            "Total Neutral Interactions": 0
        },
        "Total User Percentage of Interactions": {
            "time_spent": 42.857142857142854,
            "peoples_choise": 14.285714285714285,
            "comment": 14.285714285714285,
            "like": 14.285714285714285,
            "dislike": 14.285714285714285
        }
    },
    "User Level": "Average Audience",
    "Association Breakdown": {
        "Friend Relationship": {
            "Immediate MPXR score By friend": 0.0,
            "Monthly MPXR score By friend": 0.0
        },
        "Follow Relationship": {
            "Monthly MPXR score By Follow": 0.0
        }
    },
    "Reputation Score Breakdown by number": {
        "MPXR Total From Interaction": 2.5,
    "MPXR Total From Profile Completion": 0.8,
        "MPXR From Time Spent": 1.5,
        "MPXR From people's Choice": 1.0,
        "MPXR From Comment": {
            "MPXR Reward By Comment": 0.00055665,
            "MPXR Reward From Comment": 0.0003711
        },
        "MPXR From Publication": {},
        "MPXR From Social Post": {
            "MPXR score from user interaction": 0,
            "MPXR reward for publication": 0.0
        },
        "MPXR From Login": {
            "From Daily Login": 0.0,
            "Straight Login Bonus": 0.0
        }
    },
    "Network Breakdown": {
        "Source of Positive MPXR Score": {
            "Expert Audience": 0,
            "Advanced Audience": 0,
            "Intermediate Audience": 0,
            "Average Audience": 0
        },
        "Source of Negative MPXR Score": {
            "Expert Audience": 0,
            "Advanced Audience": 0,
            "Intermediate Audience": 0,
            "Average Audience": 0
        }
    },
    "Content Consumption Breakdown": {
        "articles/text": {
            "total": 3,
            "completed": 0,
            "more_than_half": 3,
            "less_than_half": 0,
            "completed_percentage": 0.0,
            "more_than_half_percentage": 100.0,
            "less_than_half_percentage": 0.0
        },
        "podcasts/audio": {
            "total": 0,
            "completed": 0,
            "more_than_half": 0,
            "less_than_half": 0,
            "completed_percentage": 0,
            "more_than_half_percentage": 0,
            "less_than_half_percentage": 0
        },
        "video": {
            "total": 0,
            "completed": 0,
            "more_than_half": 0,
            "less_than_half": 0,
            "completed_percentage": 0,
            "more_than_half_percentage": 0,
            "less_than_half_percentage": 0
        }
    },
    "User Categorical read time Breakdown": [
        {
            "category": "3D Printing",
            "percentage of spent time": 33.33333337777778
        },
        {
            "category": "Aged Care",
            "percentage of spent time": 33.33333337777778
        },
        {
            "category": "AI",
            "percentage of spent time": 33.33333324444445
        }
    ],
    "User Categorical Reputation from Time-Spent interaction": [
        {
            "category": "3D Printing",
            "reputation": 1.5,
            "percentage": 33.33333337777778
        },
        {
            "category": "Aged Care",
            "reputation": 1.5,
            "percentage": 33.33333337777778
        },
        {
            "category": "AI",
            "reputation": 1.5,
            "percentage": 33.33333324444445
        }
    ],
    // 
    "User Emoji Interaction By Type Percentage Breakdown": {
        "Emoji Reaction Breakdown": {
            "Positive Reaction": {
                "This content is perfect!": 0,
                "This content is excellent!": 0,
                "This Content is very good.": 0,
                "This content is well done.": 0,
                "This content is at least interesting.": 0,
                "This content is not bad.": 0
            },
            "Negative Reaction": {
                "This content is useless and mostly wrong": 0,
                "This content is so bad.": 0,
                "This content has some errors.": 0,
                "This content is provocative and might be factually and logically wrong.": 0,
                "This content is boring.": 0,
                "This content is badly presented.": 0
            }
        }
    },
    "User Comment Interaction By Type Percentage Breakdown": {
        "User Comment Interaction Percentages Breakdown": {
            "Percentage of Comment": {
                "Percentage of All Best": 33.33333333333333,
                "Percentage of All Good": 0.0,
                "Percentage of All Average": 0.0,
                "Percentage of All Expedient": 16.666666666666664,
                "Percentage of Hate Speech": 0.0,
                "Percentage of Bullying": 33.33333333333333,
                "Percentage of Vulgar": 0.0,
                "Percentage of Spamming": 16.666666666666664
            }
        }
    },
    "User Like Interaction By Type Breakdown": {
        "User Like Interaction By Type": {
            "Percentages": {
                "Percentage of Thumbs Up": 60.0,
                "Percentage of Thumbs Down": 40.0
            },
            "Breakdown by Quality": {
                "Percentage of Thumbs Up": {
                    "No. of Best Quality Int.": 2,
                    "No. of Good Quality Int.": 0,
                    "No. of Average Quality Int.": 0,
                    "No. of Low Quality Int.": 1
                },
                "Percentage of Thumbs Down": {
                    "No. of Best Quality Int.": 1,
                    "No. of Good Quality Int.": 0,
                    "No. of Average Quality Int.": 0,
                    "No. of Low Quality Int.": 1
                }
            }
        }
    },
    "User Interaction by Quality Breakdown": {
        "User Interaction by Quality": {
            "No. of Best Quality Int.": 5,
            "No. of Good Quality Int.": 1,
            "No. of Average Quality Int.": 0,
            "No. of Low Quality Int.": 6
        }
    }
    }
];



    // Base chart configurations for reusability
    const baseTitleStyle = {
    textStyle: { color: '#fff' },
    };
    const baseLabelStyle = {
    fontSize: 14,
    color: '#fff',
    };
    

    // USer cateogrical Reputation chart
const initUserCategoricalReputationChart = (data) => {
  const chart = echarts.init(userSelectors.userCategoricalReputationChart);
  const categoriesData = (data.categories || []).map((item) => ({
    name: item.category,
    value: item.rep,
  }));

  chart.setOption({
    title: {
      text: "User Categorical Reputation",
      left: "center",
      textStyle: { color: "#fff" },
    },
    tooltip: { trigger: "item", formatter: "{b}: {c}" },
    legend: {
      orient: "vertical",
      left: "left",
      textStyle: { color: "#fff" },
    },
    series: [
      {
        name: "Categories",
        type: "pie",
        radius: "50%",
        data: categoriesData,
        label:{fontSize: 14, color: '#fff',},
        color: ["#8979FF", "#79FF8D", "#FF9B5C"],
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: "rgba(0, 0, 0, 0.5)",
          },
        },
      },
    ],
  });
};

// Network Analysis Chart
// 
const initNetworkAnalysisReputationChart = (data) => {
  const chart = echarts.init(userSelectors.networkAnalysisReputationChart);

  const breakdown = data["Network Breakdown"];
  console.log("network analysis data", breakdown);
  if (!breakdown) {
    console.error("Network Breakdown data is undefined", breakdown);
    return;
  }

  const source = breakdown.hasOwnProperty("Source of Positive MPXR Score")
    ? [breakdown["Source of Positive MPXR Score"], breakdown["Source of Negative MPXR Score"]]
    : null;

  if (!source) {
    console.error("Network Breakdown source data is not available or undefined", source);
    return;
  }

  const categories = Object.keys(source[0] || {});
  const positiveData = Object.values(source[0] || {});
  const negativeData = Object.values(source[1] || {});

  // Base chart options
  const baseOption = {
    title: {
      text: "Network Analysis Breakdown",
      left: "center",
      textStyle: { color: "#fff" },
    },
    polar: {
      center: ["50%", "40%"],
      radius: [35, "60%"],
    },
    angleAxis: { max: Math.max(...positiveData, ...negativeData), startAngle: 75 },
    radiusAxis: {
      type: "category",
      data: categories,
    },
    tooltip: { trigger: "item" },
    series: [
      {
        name: "Source of Positive Reputation",
        type: "bar",
        data: positiveData,
        coordinateSystem: "polar",
        stack: "total",
        itemStyle: { color: "#5470C6" },
        label: {
          show: true,
          position: "middle",
          formatter: "{b}: {c}",
          fontSize: 10,
          color: "#fff",
        },
      },
      {
        name: "Source of Negative Reputation",
        type: "bar",
        data: negativeData,
        coordinateSystem: "polar",
        stack: "total",
        itemStyle: { color: "#91cc75" },
        label: {
          show: true,
          position: "middle",
          formatter: "{b}: {c}",
          fontSize: 10,
          color: "#fff",
        },
      },
    ],
  };

  // Responsive function to update chart options
  const updateResponsiveOption = () => {
    const screenWidth = window.innerWidth;

    // Adjust settings if the screen width is less than or equal to 950px
    if (screenWidth <= 950) {
      chart.setOption({
        polar: {
          center: ["50%", "50%"], // Adjust polar center
          radius: [20, "50%"], // Adjust radius for smaller screens
        },
        series: baseOption.series.map((series) => ({
          ...series,
          label: {
            ...series.label,
            fontSize: 8, // Reduce font size for labels
          },
        })),
      });
    } else {
      // Reset to default settings for larger screens
      chart.setOption(baseOption);
    }
  };

  // Initialize the chart with the base options
  chart.setOption(baseOption);

  // Add event listener for window resizing
  window.addEventListener("resize", () => {
    chart.resize(); // Ensure the chart resizes properly
    updateResponsiveOption(); // Update options based on screen width
  });

  // Apply responsive options immediately
  updateResponsiveOption();
};


// User Expertise Level and User Nature Chart

const initUserExpertiseLevelChart = (data) => {
  const chart = echarts.init(userSelectors.userExpertiseLevelChart);

  const expertiseNatureTree = [
    {
      name: "User Profile",
      children: [
        {
          name: "User Nature",
          children: Object.entries(data["User Nature"] || {}).map(([key, value]) => ({
            name: `${key}: ${value}`,
          })),
        },
        {
          name: "User Level",
          value: data["User Level"],
        },
      ],
    },
  ];

  chart.setOption({
    title: {
      text: "User Profile Tree",
      left: "center",
      textStyle: { color: "#fff" },
    },
    tooltip: { trigger: "item", formatter: "{b}" },
    series: [
      {
        type: "tree",
        data: expertiseNatureTree,
        top: "10%",
        left: "15%",
        bottom: "10%",
        right: "15%",
        symbol: "circle",
        symbolSize: 10,
        label: {
          position: "top",
          verticalAlign: "middle",
          align: "right",
          fontSize: 14,
          color: "#fff",
        },
        leaves: {
          label: {
            position: "bottom",
            verticalAlign: "middle",
            align: "left",
            color: "#fff",
          },
        },
        expandAndCollapse: true,
        animationDuration: 750,
        animationEasing: "quinticInOut",
      },
    ],
  });
};

// Interaction Breakdown Chart
// Configurable data paths
const dataPaths = {
  emojiReaction: "User Emoji Interaction By Type Percentage Breakdown.Emoji Reaction Breakdown",
  commentInteraction: "User Comment Interaction By Type Percentage Breakdown.User Comment Interaction Percentages Breakdown",
  likeInteraction: "User Like Interaction By Type Breakdown.User Like Interaction By Type.Breakdown by Quality",
  qualityInteraction: "User Interaction by Quality Breakdown.User Interaction by Quality",
};

// Configurable categories
const categories = {
  emojiReaction: ["Positive Reaction", "Negative Reaction"],
  like: ["Thumbs Up", "Thumbs Down"],
  comment: [
    "Percentage of All Best",
    "Percentage of All Good",
    "Percentage of All Average",
    "Percentage of All Expedient",
    "Percentage of Hate Speech",
    "Percentage of Bullying",
    "Percentage of Vulgar",
    "Percentage of Spamming",
  ],
};

// Helper function to access nested data
const getNestedData = (data, path) => {
  return path.split('.').reduce((obj, key) => obj?.[key], data);
};

// Transform data into a hierarchical tree structure
const transformToInteractionTree = (data) => {
  const emojiReactionData = getNestedData(data, dataPaths.emojiReaction);
  const commentInteractionData = getNestedData(data, dataPaths.commentInteraction);
  const likeInteractionData = getNestedData(data, dataPaths.likeInteraction);
  const qualityInteractionData = getNestedData(data, dataPaths.qualityInteraction);

  return [
    {
      name: "Interaction Breakdown",
      children: [
        {
          name: "Emoji Reaction Breakdown",
          children: categories.emojiReaction.map((category) => ({
            name: category,
            children: Object.keys(emojiReactionData[category]).map((reaction) => ({
              name: `${category} - ${reaction}`,
              value: emojiReactionData[category][reaction],
              children: [], // Placeholder for further nested breakdowns
            })),
          })),
        },
        {
          name: "Comment Interaction Percentages Breakdown",
          children: categories.comment.map((commentType) => ({
            name: commentType,
            value: commentInteractionData[commentType],
            children: [], // Placeholder for further nested breakdowns
          })),
        },
        {
          name: "Like Interaction Breakdown",
          children: categories.like.map((category) => ({
            name: category,
            children: Object.keys(likeInteractionData[`Percentage of ${category}`]).map((quality) => ({
              name: `${category} - ${quality}`,
              value: likeInteractionData[`Percentage of ${category}`][quality],
              children: [], // Placeholder for further nested breakdowns
            })),
          })),
        },
        {
          name: "Interaction by Quality Breakdown",
          children: Object.keys(qualityInteractionData).map((quality) => ({
            name: quality,
            value: qualityInteractionData[quality],
            children: [], // Placeholder for further nested breakdowns
          })),
        },
      ],
    },
  ];
};

// Chart configuration
const chartConfig = {
  title: {
    text: 'Interaction Breakdown Tree',
    left: 'center',
    textStyle: { color: '#fff' },
  },
  tooltip: { trigger: 'item', formatter: '{b}' },
  series: [
    {
      type: 'tree',
      top: '5%',
      left: '15%',
      bottom: '5%',
      right: '15%',
      symbol: 'circle',
      symbolSize: 10,
      label: {
        position: 'top',
        verticalAlign: 'middle',
        align: 'right',
        fontSize: 12,
        color: '#fff',
      },
      leaves: {
        label: {
          position: 'bottom',
          verticalAlign: 'middle',
          align: 'left',
          color: '#fff',
        },
      },
      expandAndCollapse: true,
      animationDuration: 750,
      animationEasing: 'quinticInOut',
    },
  ],
};

// Initialize the chart
const initInteractionBreakdownChart = (data) => {
  const chart = echarts.init(userSelectors.interactionBreakdownChart);
  const interactionTreeData = transformToInteractionTree(data);

  chart.setOption({
    ...chartConfig,
    series: [{ ...chartConfig.series[0], data: interactionTreeData }],
  });
};


// MPXR From Publication Chart
const initMPXRFromPublicationChart = (data) => {
  const chart = echarts.init(userSelectors.mpxrFromPublicationChart);

  const categories = ["MPXR From Social Post", "MPXR From Comment"];
  const rewardData = [
    data["Reputation Score Breakdown by number"]["MPXR From Social Post"]["MPXR reward for publication"] || 0,
    data["Reputation Score Breakdown by number"]["MPXR From Comment"]["MPXR Reward By Comment"] || 0,
  ];
  const scoreData = [
    data["Reputation Score Breakdown by number"]["MPXR From Social Post"]["MPXR score from user interaction"] || 0,
    data["Reputation Score Breakdown by number"]["MPXR From Comment"]["MPXR Reward From Comment"] || 0,
  ];

  chart.setOption({
    title: {
      text: "No. of MPXR From Publication",
      left: "center",
      textStyle: { color: "#fff" },
    },
    tooltip: { trigger: "axis" },
    grid: { left: "20%" },
    yAxis: {
      type: "category",
      data: categories,
    },
    xAxis: { type: "value" },
    series: [
      {
        name: "Reward",
        type: "bar",
        stack: "Total",
        data: rewardData,
        itemStyle: { color: "#5470C6" },
      },
      {
        name: "Score",
        type: "bar",
        stack: "Total",
        data: scoreData,
        itemStyle: { color: "#91cc75" },
      },
    ],
  });
};

// MPXR From Interaction Chart
const initMPXRFromInteractionChart = (data) => {
  const chart = echarts.init(userSelectors.mpxrFromInteractionChart);

  const interactionData = Object.entries(
    data["Total User Interaction Breakdown"]["Total User Percentage of Interactions"] || {}
  ).map(([key, value]) => ({
    name: key,
    value,
  }));

  chart.setOption({
    title: {
      text: "MPXR From Interaction Percentage",
      left: "center",
      textStyle: { color: "#fff" },
    },
    tooltip: { trigger: "item" },
    legend: {
      orient: "vertical",
      left: "left",
      textStyle: { color: "#fff" },
    },
    series: [
      {
        name: "Interaction Percentage",
        type: "pie",
        radius: "50%",
        data: interactionData,
        label: { fontSize: 14, color: "#fff" },
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: "rgba(0, 0, 0, 0.5)",
          },
        },
      },
    ],
  });
};


const initializeUserProfileCharts = (userProfileDataArray) => {
  const user = userProfileDataArray[0]; 
  initUserCategoricalReputationChart(user);
  initNetworkAnalysisReputationChart(user);
  initUserExpertiseLevelChart(user);
  initInteractionBreakdownChart(user);
  initMPXRFromPublicationChart(user);
  initMPXRFromInteractionChart(user);
};

// Initialize charts
initializeUserProfileCharts(userProfileData);

  </script>
  <!-- <script type="module" src="/src/main.js"></script> -->
</body>

</html>